sentinel哨兵模式
https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6
1.引入jar,修改yml文件(sentinel服务器)
2.添加注解
   每个endpoint都需要添加@SentinelResource("/service/A")
3.可以在界面实现动态流控了
  访问地址： http://localhost:8080/
  流控：QPS-> （流控模式）直接 -> 快速失败
    演示效果：1.QPS（每秒请求数） 设置阈值 1 ，快速刷新页面就发现访问不了。直接页面报错
  流控：线程数-> （流控模式）直接。设置1
   只有一个线程进行处理。其余的只能直接失败，没有任何响应
 流控模式->关联
   
   当流控模式->关联->直接失败
    场景： 当支付模块压力大的时候，下单模块就限流处理
   模拟： 在A接口添加关联。当B满了就限制A的访问
    postman多线程并发请求B接口，手动请求，看看A是否能访问？实现关联的管理
   有点绕口： 对接口/service/A,实现关联 接口/service/B.设置相关的限流，  postman多线程并发请求B接口，手动请求，接口A直接挂了？实现关联的管理
   
流控效果：Warm Up 预热
wiki:https://github.com/alibaba/Sentinel/wiki/%E9%99%90%E6%B5%81---%E5%86%B7%E5%90%AF%E5%8A%A8
 默认 coldFactor 为 3，即请求 QPS 从 threshold/3 开始，经预热时长逐渐升至设定的 QPS 阈值
 WarmUpController.java  79行
举例说明： 设置QPS阈值10，预热 5秒
 QPS 从 10/3 约 3 开始，然后5秒内达到 10 ;
 刚开始会报错，当5s之后就正常了。
 
 流控效果：排队等待
 请求以均匀的速度通过，对应的漏桶算法。
 适合锯齿请求波峰
 https://github.com/alibaba/Sentinel/wiki/%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6-%E5%8C%80%E9%80%9F%E6%8E%92%E9%98%9F%E6%A8%A1%E5%BC%8F
 以固定的间隔时间让请求通过。当请求到来的时候，如果当前请求距离上个通过的请求通过的时间间隔不小于预设值，则让当前请求通过；
 否则，计算当前请求的预期通过时间，如果该请求的预期通过时间小于规则预设的 timeout 时间，则该请求会等待直到预设时间到来通过（排队等待处理）；
 若预期的通过时间超出最大排队时长，则直接拒接这个请求。
   RateLimiterController.java 实现
 QPS有效
 
 
 降级熔断：
  规则 ： 1、RT平均响应时间   2、异常比例 3、异常数
RT: 秒级  平均响应时间 超出阈值 + 时间窗口内通过的请求数>=5 . 同时满足出发降级
窗口期过后关闭断路器，RT最大4900（更大需要通过-Dcsp.sentinel.staticstic.max.rt=XX生效）
异常比例：秒级
 QPS>=5 且异常比例超过阈值。触发降级，时间窗口结束后，关闭降级
异常数： 分钟级
异常数通过阈值，触发降级，时间窗口结束后，关闭降级

热点限流规则
 详细可看接口：serviceParam
参数例外项
高级选项：当参数为指定数值时，可以自己定制QPS

系统保护规则
 整体上面的控制
https://github.com/alibaba/Sentinel/wiki/%E7%B3%BB%E7%BB%9F%E8%87%AA%E9%80%82%E5%BA%94%E9%99%90%E6%B5%81

降级
单个：RateLimitController.java 查看



 
 
 
 
 
 
 


 
 
   
    
 
 
 
  
    
   
 
 
 
 


流控模式
1.直接QPs->快速失败-->流控模式（直接）-->--> 流控效果（直接失败）设置之后（系统默认的）,超过阈值之后，显示black limit by sentinel ()
2.线程数直接失败


A.流控模式 --> 直接
QPS 和线程数
QPS 访问直接失败。效果明显（挡在门外不让进） 
线程数:直接访问不能正常。(关门打狗)
 演示效果：线程休眠

B.流控模式 --> 关联
当与A关联的资源B达到阈值时，限流A
 演示效果：当B达到阈值时，A被限流																															 

流控效果

